{"version":3,"file":"i18n.mjs","sourceRoot":"","sources":["i18n.ts"],"names":[],"mappings":"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","sourcesContent":["import global from '../shim/global';\nimport WeakMap from '../shim/WeakMap';\nimport * as Globalize from 'globalize/dist/globalize/message';\nconst Cldr = require('cldrjs/dist/cldr');\n`!has('cldr-elide')`;\nimport './util/cldr';\n\nexport interface Messages {\n\t[key: string]: string;\n}\n\nexport interface MessageLoader {\n\t(): Promise<{ default: Messages }>;\n}\n\nexport interface CldrLoader {\n\t(): Promise<{ default: any }[]>;\n}\n\nexport interface LocaleLoaders {\n\t[index: string]: Messages | MessageLoader;\n}\n\nexport interface CldrLoaders {\n\t[index: string]: CldrLoader | true;\n}\n\nexport interface Bundle<T extends Messages> {\n\treadonly locales?: LocaleLoaders;\n\treadonly messages: T;\n}\n\nexport interface LocalizeOptions {\n\tlocale?: string;\n\tuseDefault?: boolean;\n\tinvalidator: any;\n}\n\nexport interface LocalizeResult<T extends Bundle<any>> {\n\tmessages: T['messages'];\n\tisPlaceholder: boolean;\n\tformat: (key: keyof T['messages'], options: any) => string;\n}\n\ninterface SetLocaleOptions {\n\tlocale?: string;\n\tdefault?: boolean;\n\tlocal?: boolean;\n\tinvalidator?: () => void;\n}\n\n/**\n * Ensure that the raw bundle is not mutated when\n * the resolved bundles are set\n */\nlet cldrResolved = Cldr._resolved;\n\nObject.defineProperty(Cldr, '_resolved', {\n\tget() {\n\t\treturn { ...cldrResolved };\n\t},\n\tset(value: any) {\n\t\tcldrResolved = { ...value };\n\t}\n});\n\nconst TOKEN_PATTERN = /\\{([a-z0-9_]+)\\}/gi;\nconst bundleIdMap = new WeakMap<Bundle<Messages>, string>();\nconst bundleLoaderMap = new WeakMap<MessageLoader, string>();\nconst idToBundleLoaderMap = new Map<string, MessageLoader>();\nconst globalizeInstanceMap = new Map<string, Globalize>();\nconst MESSAGE_BUNDLE_PATH = 'globalize-messages/{bundle}';\nconst DOJO_PATH = 'dojo/{bundle}/lookup';\n\nlet supportedLocales: string[] = [];\nlet defaultLocale = '';\n// Set to `unknown` to support using default message bundles\n// without an application locale configured\nlet computedLocale = 'unknown';\nlet currentLocale: string | undefined;\nlet cldrLoaders: CldrLoaders = {};\nlet bundleId = 0;\nconst cldr = new Cldr('');\n\n/**\n * Sets the array of supported locales for the application\n */\nexport function setSupportedLocales(locales: string[]) {\n\tsupportedLocales = locales;\n}\n\n/**\n * Sets the default locale of the application.\n */\nexport function setDefaultLocale(locale: string) {\n\tdefaultLocale = locale;\n}\n\n/**\n * Returns the users locale computed by using the system locale\n * of the environment and the default locale.\n *\n * The users system locale if supported by the application (i.e resolves\n * to one of the set supported locales) otherwise the registered default\n * locale.\n */\nexport function getComputedLocale() {\n\treturn computedLocale;\n}\n\n/**\n * Returns the application's current locale\n */\nexport function getCurrentLocale() {\n\treturn currentLocale;\n}\n\n/**\n * Sets the available cldr loaders for the i18n module\n */\nexport function setCldrLoaders(loaders: CldrLoaders) {\n\tcldrLoaders = { ...loaders };\n}\n\n/**\n * Returns the matching supported locale for the passed locale. If there\n * is no matching locale then undefined is returned\n */\nexport function getMatchedSupportedLocale(locale: string): string | undefined {\n\tlet partialLocale = locale.replace(/^([a-z]{2}).*/i, '$1');\n\tlet matchedLocale;\n\tfor (let i = 0; i < supportedLocales.length; i++) {\n\t\tconst supportedLocale = supportedLocales[i];\n\t\tif (locale === supportedLocale) {\n\t\t\tmatchedLocale = locale;\n\t\t\tbreak;\n\t\t}\n\t\tif (partialLocale === supportedLocale) {\n\t\t\tmatchedLocale = partialLocale;\n\t\t}\n\t}\n\treturn matchedLocale;\n}\n\n/**\n * Determines if the fallback CLDR data needs to be loaded\n * for the locale\n */\nfunction shouldLoadFallbackCldr(locale: string) {\n\treturn !getMatchedSupportedLocale(locale) && cldrLoaders.fallback && cldrLoaders.fallback !== true;\n}\n\n/**\n * Sets the i18n modules locale state based on whether the locale\n * is the default or local\n */\nfunction setI18nLocales(locale: string, isDefault: boolean, local: boolean): void {\n\tif (isDefault) {\n\t\tGlobalize.locale(locale);\n\t\tcomputedLocale = locale;\n\t\tcurrentLocale = locale;\n\t} else if (!local) {\n\t\tcurrentLocale = locale;\n\t}\n}\n\n/**\n * Load required CLDR data based on the registered loaders and support\n * for the requested locale\n */\nasync function loadCldrData(\n\tloaderPromises: Promise<any>[],\n\tuserLocale: string,\n\trequestedLocale: string,\n\tcalculatedLocale: string,\n\tisDefault: boolean,\n\tisLocal: boolean,\n\tinvalidator?: () => void\n): Promise<any> {\n\treturn Promise.all(loaderPromises).then((loaderData) => {\n\t\tcldrLoaders[userLocale] = true;\n\t\tcldrLoaders.supplemental = true;\n\t\tloaderData.forEach((results) => {\n\t\t\tresults.forEach((result: any) => {\n\t\t\t\tGlobalize.load(result.default);\n\t\t\t});\n\t\t});\n\t\tif (shouldLoadFallbackCldr(requestedLocale)) {\n\t\t\tcldrLoaders.fallback = true;\n\t\t\tconst data = cldr.get('dojo') || {};\n\t\t\tconst locales = Object.keys(data);\n\t\t\tfor (let i = 0; i < locales.length; i++) {\n\t\t\t\tconst locale = locales[i];\n\t\t\t\tif (data[locale].bundles) {\n\t\t\t\t\tGlobalize.loadMessages({ [locale]: data[locale].bundles });\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (requestedLocale && locales.indexOf(requestedLocale) === -1) {\n\t\t\t\tGlobalize.loadMessages({ [requestedLocale]: {} });\n\t\t\t}\n\t\t}\n\t\tsetI18nLocales(calculatedLocale, isDefault, isLocal);\n\t\tinvalidator && invalidator();\n\t\treturn calculatedLocale;\n\t});\n}\n\n/**\n * Sets the i18n locale information for the application, loading any CLDR data or NLS\n * messages required to support the change.\n */\nexport function setLocale(options: SetLocaleOptions = {}): Promise<string> | string {\n\tconst {\n\t\tlocal: isLocal = false,\n\t\tdefault: isDefault = false,\n\t\tlocale: requestedLocale = global.navigator.language || global.navigator.userLanguage,\n\t\tinvalidator\n\t} = options;\n\tconst matchedLocale = getMatchedSupportedLocale(requestedLocale);\n\tconst userLocale = matchedLocale || defaultLocale;\n\tconst calculatedLocale = matchedLocale ? requestedLocale : defaultLocale;\n\n\tconst loaderPromises: Promise<any>[] = [];\n\tconst supplementalLoader = cldrLoaders.supplemental;\n\tconst fallbackLoader = cldrLoaders.fallback;\n\n\tif (supplementalLoader && supplementalLoader !== true) {\n\t\tloaderPromises.push(supplementalLoader());\n\t}\n\tconst localeCldrLoader = cldrLoaders[userLocale];\n\tif (localeCldrLoader && localeCldrLoader !== true) {\n\t\tloaderPromises.push(localeCldrLoader());\n\t}\n\tconst loadFallback = !matchedLocale && fallbackLoader && fallbackLoader !== true;\n\tif (loadFallback && fallbackLoader && fallbackLoader !== true) {\n\t\tloaderPromises.push(fallbackLoader());\n\t}\n\n\tif (loaderPromises.length) {\n\t\treturn loadCldrData(\n\t\t\tloaderPromises,\n\t\t\tuserLocale,\n\t\t\trequestedLocale,\n\t\t\tcalculatedLocale,\n\t\t\tisDefault,\n\t\t\tisLocal,\n\t\t\tinvalidator\n\t\t);\n\t} else if (!matchedLocale) {\n\t\tGlobalize.loadMessages({ [requestedLocale]: {} });\n\t}\n\n\tsetI18nLocales(calculatedLocale, isDefault, isLocal);\n\treturn calculatedLocale;\n}\n\nfunction getPlaceholderBundle<T extends Messages>(bundle: Bundle<T>) {\n\treturn {\n\t\tmessages: Object.keys(bundle.messages).reduce(\n\t\t\t(messages, key) => {\n\t\t\t\tmessages[key] = '';\n\t\t\t\treturn messages;\n\t\t\t},\n\t\t\t{} as any\n\t\t),\n\t\tisPlaceholder: true,\n\t\tformat: () => ''\n\t};\n}\n\nfunction getBundleId() {\n\treturn `id-${++bundleId}`;\n}\n\nfunction markBundleAsLoaded(locale: string, bundleId: string) {\n\tCldr.load({\n\t\tdojo: {\n\t\t\t[locale]: {\n\t\t\t\tlookup: {\n\t\t\t\t\t[bundleId]: {\n\t\t\t\t\t\tlocale: undefined,\n\t\t\t\t\t\tid: undefined,\n\t\t\t\t\t\tloading: undefined\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\n/**\n * Registers all locale loaders for the bundle\n */\nfunction registerBundle<T extends Messages>(bundle: Bundle<T>): string {\n\tconst { locales: localeBundleLoaders = {} } = bundle;\n\tconst locales = Object.keys(localeBundleLoaders);\n\tlet bundleId = bundleIdMap.get(bundle);\n\tif (!bundleId) {\n\t\tbundleId = getBundleId();\n\t\tbundleIdMap.set(bundle, bundleId);\n\t\tconst messageBundles: { [index: string]: any } = {};\n\t\tconst lookup: { [index: string]: any } = {};\n\n\t\tfor (let i = 0; i < locales.length; i++) {\n\t\t\tconst locale = locales[i];\n\t\t\tconst isSupportedLocale = !!getMatchedSupportedLocale(locale);\n\t\t\tconst bundleLoader = localeBundleLoaders[locale];\n\t\t\tlet messages = {};\n\t\t\tif (typeof bundleLoader === 'function') {\n\t\t\t\tconst id = getBundleId();\n\t\t\t\tbundleLoaderMap.set(bundleLoader, id);\n\t\t\t\tidToBundleLoaderMap.set(id, bundleLoader);\n\t\t\t\tlookup[locale] = { lookup: { [bundleId]: { locale, id } } };\n\t\t\t} else {\n\t\t\t\tmessages = bundleLoader;\n\t\t\t}\n\t\t\tif (isSupportedLocale) {\n\t\t\t\tmessageBundles[locale] = {\n\t\t\t\t\t[bundleId]: messages\n\t\t\t\t};\n\t\t\t} else if (lookup[locale]) {\n\t\t\t\tlookup[locale].bundles = { [bundleId]: messages };\n\t\t\t} else {\n\t\t\t\tlookup[locale] = {\n\t\t\t\t\tbundles: { [bundleId]: messages }\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tGlobalize.loadMessages({\n\t\t\troot: { [bundleId]: bundle.messages },\n\t\t\t[computedLocale]: { [bundleId]: bundle.messages },\n\t\t\t[defaultLocale]: { [bundleId]: bundle.messages },\n\t\t\t...messageBundles\n\t\t});\n\t\tCldr.load({ dojo: lookup });\n\t}\n\treturn bundleId;\n}\n\nconst cachedBundleMap = new WeakMap<Bundle<any>, Map<string, LocalizeResult<Bundle<any>>>>();\n\nexport function localizeBundle<T extends Messages>(\n\tbundle: Bundle<T>,\n\toptions: LocalizeOptions\n): LocalizeResult<Bundle<T>> {\n\tlet { locale = computedLocale, invalidator } = options;\n\tif (computedLocale === 'unknown') {\n\t\treturn {\n\t\t\tmessages: bundle.messages,\n\t\t\tisPlaceholder: false,\n\t\t\tformat: (key, options) => {\n\t\t\t\treturn bundle.messages[key].replace(TOKEN_PATTERN, (token, property) => {\n\t\t\t\t\tconst value = options[property];\n\t\t\t\t\tif (typeof value === 'undefined') {\n\t\t\t\t\t\treturn token;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\tif (shouldLoadFallbackCldr(locale)) {\n\t\tsetLocale({ default: false, local: true, locale, invalidator });\n\t\treturn getPlaceholderBundle(bundle);\n\t}\n\tconst bundleId = registerBundle(bundle);\n\tconst globalize = globalizeInstanceMap.get(locale) || new Globalize(new Cldr(locale));\n\tglobalizeInstanceMap.set(locale, globalize);\n\tconst lookupId = globalize.cldr.get(`${DOJO_PATH}/${bundleId}/id`);\n\tconst lookupLocale = globalize.cldr.get(`${DOJO_PATH}/${bundleId}/locale`);\n\tif (lookupId && lookupLocale) {\n\t\tlet bundleLoader = idToBundleLoaderMap.get(lookupId);\n\t\tif (bundleLoader) {\n\t\t\tCldr.load({\n\t\t\t\tdojo: {\n\t\t\t\t\t[lookupLocale]: { lookup: { [bundleId]: { loading: true } } }\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst loaderPromise = bundleLoader();\n\t\t\tloaderPromise.then((messages) => {\n\t\t\t\tmarkBundleAsLoaded(lookupLocale, bundleId as string);\n\t\t\t\tGlobalize.loadMessages({ [lookupLocale]: { [bundleId as string]: messages.default } });\n\t\t\t\tinvalidator();\n\t\t\t});\n\t\t}\n\t}\n\tconst lookupLoading = globalize.cldr.get(`${DOJO_PATH}/${bundleId}/loading`);\n\n\tif (lookupLoading) {\n\t\treturn getPlaceholderBundle(bundle);\n\t}\n\n\tconst cachedLocaleMessagesMap = cachedBundleMap.get(bundle) || new Map<string, LocalizeResult<Bundle<any>>>();\n\tlet localizedBundleMessages = cachedLocaleMessagesMap.get(locale);\n\tif (!localizedBundleMessages) {\n\t\tlocalizedBundleMessages = {\n\t\t\tmessages: Object.keys(bundle.messages).reduce(\n\t\t\t\t(messages, key) => {\n\t\t\t\t\tconst message = globalize.cldr.get(`${MESSAGE_BUNDLE_PATH}/${bundleId}/${key}`);\n\t\t\t\t\tmessages[key] = message;\n\t\t\t\t\treturn messages;\n\t\t\t\t},\n\t\t\t\t{} as any\n\t\t\t),\n\t\t\tisPlaceholder: false,\n\t\t\tformat: (key: any, options: {}) => {\n\t\t\t\treturn globalize.formatMessage(`${bundleId}/${key}`, options);\n\t\t\t}\n\t\t};\n\t\tcachedLocaleMessagesMap.set(locale, localizedBundleMessages);\n\t\tcachedBundleMap.set(bundle, cachedLocaleMessagesMap);\n\t}\n\treturn localizedBundleMessages;\n}\n"]}
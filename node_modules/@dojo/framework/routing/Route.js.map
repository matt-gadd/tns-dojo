{"version":3,"file":"Route.js","sourceRoot":"","sources":["Route.ts"],"names":[],"mappings":";;;;;;;;;;;IAAA,qCAAiE;IACjE,wDAAmD;IACnD,oDAA+C;IAW/C,IAAM,OAAO,GAAG,aAAM,CAAC,EAAE,MAAM,kBAAA,EAAE,QAAQ,oBAAA,EAAE,YAAY,qBAAA,EAAE,WAAW,oBAAA,EAAE,CAAC,CAAC,UAAU,EAAmB,CAAC;IAEzF,QAAA,KAAK,GAAG,OAAO,CAAC,SAAS,KAAK,CAAC,EAG3C;YAFA,kBAA2D,EAA7C,kBAAM,EAAE,sBAAQ,EAAE,8BAAY,EAAE,4BAAW,EACzD,0BAAU;QAEJ,IAAA,iBAAqD,EAAnD,sBAAQ,EAAE,UAAE,EAAE,iBAAoB,EAApB,yCAAqC,CAAC;QAC5D,IAAM,aAAa,GAAG,MAAM,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;QACrD,IAAI,CAAC,aAAa,EAAE;YACnB,IAAM,QAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAC7C,IAAI,QAAM,EAAE;gBACX,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,cAAM,OAAA,QAAM,EAAN,CAAM,CAAC,CAAC;aACnC;SACD;QACD,YAAY,CAAC,WAAW,EAAE,UAAC,OAAwB,EAAE,IAAqB;YACjE,IAAA,sBAAsC,EAAtC,gDAAsC,CAAa;YACnD,IAAA,mBAAoB,EAApB,yCAAoB,CAAU;YACtC,IAAI,SAAS,KAAK,gBAAgB,EAAE;gBACnC,IAAM,eAAa,GAAG,MAAM,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;gBACrD,IAAI,eAAa,EAAE;oBAClB,eAAa,EAAE,CAAC;iBAChB;gBACD,IAAM,QAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;gBAC7C,IAAI,QAAM,EAAE;oBACX,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,cAAM,OAAA,QAAM,EAAN,CAAM,CAAC,CAAC;iBACnC;aACD;YACD,WAAW,EAAE,CAAC;QACf,CAAC,CAAC,CAAC;QACH,IAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAS,SAAS,CAAC,CAAC;QAE/C,IAAI,MAAM,EAAE;YACX,IAAM,YAAY,GAAG,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;YACzC,IAAI,YAAY,EAAE;gBACT,IAAA,sCAAW,EAAE,4BAAM,EAAE,wBAAI,EAAE,8BAAO,EAAE,8BAAO,CAAkB;gBACrE,IAAM,MAAM,GAAG,QAAQ,CAAC,EAAE,WAAW,aAAA,EAAE,MAAM,QAAA,EAAE,IAAI,MAAA,EAAE,OAAO,SAAA,EAAE,OAAO,SAAA,EAAE,MAAM,QAAA,EAAE,CAAC,CAAC;gBACjF,IAAI,MAAM,EAAE;oBACX,OAAO,MAAM,CAAC;iBACd;aACD;SACD;QACD,OAAO,IAAI,CAAC;IACb,CAAC,CAAC,CAAC;IAEH,kBAAe,aAAK,CAAC","sourcesContent":["import { create, diffProperty, invalidator } from '../core/vdom';\nimport injector from '../core/middleware/injector';\nimport icache from '../core/middleware/icache';\nimport { DNode } from '../core/interfaces';\nimport { MatchDetails } from './interfaces';\nimport Router from './Router';\n\nexport interface RouteProperties {\n\trenderer: (matchDetails: MatchDetails) => DNode | DNode[];\n\tid: string;\n\trouterKey?: string;\n}\n\nconst factory = create({ icache, injector, diffProperty, invalidator }).properties<RouteProperties>();\n\nexport const Route = factory(function Route({\n\tmiddleware: { icache, injector, diffProperty, invalidator },\n\tproperties\n}) {\n\tconst { renderer, id, routerKey = 'router' } = properties();\n\tconst currentHandle = icache.get<Function>('handle');\n\tif (!currentHandle) {\n\t\tconst handle = injector.subscribe(routerKey);\n\t\tif (handle) {\n\t\t\ticache.set('handle', () => handle);\n\t\t}\n\t}\n\tdiffProperty('routerKey', (current: RouteProperties, next: RouteProperties) => {\n\t\tconst { routerKey: currentRouterKey = 'router' } = current;\n\t\tconst { routerKey = 'router' } = next;\n\t\tif (routerKey !== currentRouterKey) {\n\t\t\tconst currentHandle = icache.get<Function>('handle');\n\t\t\tif (currentHandle) {\n\t\t\t\tcurrentHandle();\n\t\t\t}\n\t\t\tconst handle = injector.subscribe(routerKey);\n\t\t\tif (handle) {\n\t\t\t\ticache.set('handle', () => handle);\n\t\t\t}\n\t\t}\n\t\tinvalidator();\n\t});\n\tconst router = injector.get<Router>(routerKey);\n\n\tif (router) {\n\t\tconst routeContext = router.getRoute(id);\n\t\tif (routeContext) {\n\t\t\tconst { queryParams, params, type, isError, isExact } = routeContext;\n\t\t\tconst result = renderer({ queryParams, params, type, isError, isExact, router });\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t}\n\treturn null;\n});\n\nexport default Route;\n"]}
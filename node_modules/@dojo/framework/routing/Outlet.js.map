{"version":3,"file":"Outlet.js","sourceRoot":"","sources":["Outlet.tsx"],"names":[],"mappings":"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","sourcesContent":["import { create, tsx, diffProperty, invalidator } from '../core/vdom';\nimport injector from '../core/middleware/injector';\nimport icache from '../core/middleware/icache';\nimport { RenderResult } from '../core/interfaces';\nimport { MatchDetails, RouteContext } from './interfaces';\nimport Router from './Router';\nimport { RouteProperties } from './Route';\n\nconst ROUTER_KEY = 'router';\n\nexport interface RouteMatch {\n\t[index: string]: boolean;\n}\n\nexport interface Matches {\n\t[index: string]: boolean;\n}\n\nexport interface Matcher {\n\t(defaultMatches: Matches, matchDetails: Map<string, RouteContext>): Matches;\n}\n\nexport interface OutletProperties {\n\tid: string;\n\tmatcher?: Matcher;\n\trouterKey?: string;\n}\n\nexport interface OutletChildren {\n\t[index: string]: RenderResult | ((matchDetails: MatchDetails) => RenderResult);\n}\n\nexport interface OutletFunctionChild {\n\t(matchDetails: MatchDetails): RenderResult;\n}\n\nconst factory = create({ icache, injector, diffProperty, invalidator })\n\t.properties<OutletProperties>()\n\t.children<OutletChildren | OutletFunctionChild>();\n\nexport const Outlet = factory(function Outlet({\n\tmiddleware: { icache, injector, diffProperty, invalidator },\n\tproperties,\n\tchildren\n}) {\n\tdiffProperty('routerKey', (current: RouteProperties, next: RouteProperties) => {\n\t\tconst { routerKey: currentRouterKey = ROUTER_KEY } = current;\n\t\tconst { routerKey = ROUTER_KEY } = next;\n\t\tif (routerKey !== currentRouterKey) {\n\t\t\tconst currentHandle = icache.get<Function>('handle');\n\t\t\tif (currentHandle) {\n\t\t\t\tcurrentHandle();\n\t\t\t}\n\t\t\tconst handle = injector.subscribe(routerKey);\n\t\t\tif (handle) {\n\t\t\t\ticache.set('handle', () => handle);\n\t\t\t}\n\t\t}\n\t\tinvalidator();\n\t});\n\tconst { id, matcher, routerKey = ROUTER_KEY } = properties();\n\tconst [outletChildren] = children();\n\n\tconst currentHandle = icache.get<Function>('handle');\n\tif (!currentHandle) {\n\t\tconst handle = injector.subscribe(routerKey);\n\t\tif (handle) {\n\t\t\ticache.set('handle', () => handle);\n\t\t}\n\t}\n\n\tconst router = injector.get<Router>(routerKey);\n\n\tif (router) {\n\t\tconst currentRouteContext = router.getMatchedRoute();\n\t\tconst routeContextMap = router.getOutlet(id);\n\t\tif (routeContextMap && currentRouteContext) {\n\t\t\tif (typeof outletChildren === 'function') {\n\t\t\t\treturn outletChildren({ ...currentRouteContext, router });\n\t\t\t}\n\t\t\tlet matches = Object.keys(outletChildren).reduce(\n\t\t\t\t(matches, key) => {\n\t\t\t\t\tmatches[key] = !!routeContextMap.get(key);\n\t\t\t\t\treturn matches;\n\t\t\t\t},\n\t\t\t\t{} as Matches\n\t\t\t);\n\t\t\tif (matcher) {\n\t\t\t\tmatches = matcher(matches, routeContextMap);\n\t\t\t}\n\t\t\treturn (\n\t\t\t\t<virtual>\n\t\t\t\t\t{Object.keys(matches)\n\t\t\t\t\t\t.filter((key) => matches[key])\n\t\t\t\t\t\t.map((key) => {\n\t\t\t\t\t\t\tconst renderer = outletChildren[key];\n\t\t\t\t\t\t\tif (typeof renderer === 'function') {\n\t\t\t\t\t\t\t\tconst context = routeContextMap.get(key) || currentRouteContext;\n\t\t\t\t\t\t\t\treturn renderer({ ...context, router });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn renderer;\n\t\t\t\t\t\t})}\n\t\t\t\t</virtual>\n\t\t\t);\n\t\t}\n\t}\n\treturn null;\n});\n\nexport default Outlet;\n"]}
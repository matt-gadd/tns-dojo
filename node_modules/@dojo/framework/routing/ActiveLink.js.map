{"version":3,"file":"ActiveLink.js","sourceRoot":"","sources":["ActiveLink.ts"],"names":[],"mappings":"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","sourcesContent":["import { create, diffProperty, invalidator, w } from '../core/vdom';\nimport { Handle } from '../core/Destroyable';\nimport injector from '../core/middleware/injector';\nimport icache from '../core/middleware/icache';\nimport { SupportedClassName } from '../core/interfaces';\nimport Link, { LinkProperties } from './Link';\nimport Router from './Router';\n\nexport interface ActiveLinkProperties extends LinkProperties {\n\tactiveClasses: SupportedClassName[];\n\tisExact?: boolean;\n}\n\nfunction paramsEqual(linkParams: any = {}, contextParams: any = {}) {\n\treturn Object.keys(linkParams).every((key) => linkParams[key] === contextParams[key]);\n}\n\nconst factory = create({ injector, diffProperty, icache, invalidator }).properties<ActiveLinkProperties>();\n\nexport const ActiveLink = factory(function ActiveLink({\n\tmiddleware: { diffProperty, injector, icache, invalidator },\n\tproperties,\n\tchildren\n}) {\n\tconst { to, routerKey = 'router', params } = properties();\n\tlet { activeClasses, isExact, classes = [], ...props } = properties();\n\n\tdiffProperty('to', (current: ActiveLinkProperties, next: ActiveLinkProperties) => {\n\t\tif (current.to !== next.to) {\n\t\t\tconst router = injector.get<Router>(routerKey);\n\t\t\tconst currentHandle = icache.get<Handle>('handle');\n\t\t\tif (currentHandle) {\n\t\t\t\tcurrentHandle.destroy();\n\t\t\t}\n\t\t\tif (router) {\n\t\t\t\tconst handle = router.on('route', ({ route }) => {\n\t\t\t\t\tif (route.id === to) {\n\t\t\t\t\t\tinvalidator();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ticache.set('handle', () => handle);\n\t\t\t}\n\t\t\tinvalidator();\n\t\t}\n\t});\n\n\tconst router = injector.get<Router>(routerKey);\n\tif (router) {\n\t\tif (!icache.get('handle')) {\n\t\t\tconst handle = router.on('route', ({ route }) => {\n\t\t\t\tif (route.id === to) {\n\t\t\t\t\tinvalidator();\n\t\t\t\t}\n\t\t\t});\n\t\t\ticache.set('handle', () => handle);\n\t\t}\n\t\tconst context = router.getRoute(to);\n\t\tconst isActive = context && paramsEqual(params, { ...context.params, ...context.queryParams });\n\t\tconst contextIsExact = context && context.isExact();\n\n\t\tclasses = Array.isArray(classes) ? classes : [classes];\n\t\tif (isActive && (!isExact || contextIsExact)) {\n\t\t\tclasses = [...classes, ...activeClasses];\n\t\t}\n\t\tprops = { ...props, classes };\n\t}\n\treturn w(Link, props, children());\n});\n\nexport default ActiveLink;\n"]}
{"version":3,"file":"ActiveLink.mjs","sourceRoot":"","sources":["ActiveLink.ts"],"names":[],"mappings":"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","sourcesContent":["import { create, diffProperty, invalidator, w } from '../core/vdom';\nimport { Handle } from '../core/Destroyable';\nimport injector from '../core/middleware/injector';\nimport icache from '../core/middleware/icache';\nimport { SupportedClassName } from '../core/interfaces';\nimport Link, { LinkProperties } from './Link';\nimport Router from './Router';\n\nexport interface ActiveLinkProperties extends LinkProperties {\n\tactiveClasses: SupportedClassName[];\n\tisExact?: boolean;\n}\n\nfunction paramsEqual(linkParams: any = {}, contextParams: any = {}) {\n\treturn Object.keys(linkParams).every((key) => linkParams[key] === contextParams[key]);\n}\n\nconst factory = create({ injector, diffProperty, icache, invalidator }).properties<ActiveLinkProperties>();\n\nexport const ActiveLink = factory(function ActiveLink({\n\tmiddleware: { diffProperty, injector, icache, invalidator },\n\tproperties,\n\tchildren\n}) {\n\tconst { to, routerKey = 'router', params } = properties();\n\tlet { activeClasses, isExact, classes = [], ...props } = properties();\n\n\tdiffProperty('to', (current: ActiveLinkProperties, next: ActiveLinkProperties) => {\n\t\tif (current.to !== next.to) {\n\t\t\tconst router = injector.get<Router>(routerKey);\n\t\t\tconst currentHandle = icache.get<Handle>('handle');\n\t\t\tif (currentHandle) {\n\t\t\t\tcurrentHandle.destroy();\n\t\t\t}\n\t\t\tif (router) {\n\t\t\t\tconst handle = router.on('route', ({ route }) => {\n\t\t\t\t\tif (route.id === to) {\n\t\t\t\t\t\tinvalidator();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ticache.set('handle', () => handle);\n\t\t\t}\n\t\t\tinvalidator();\n\t\t}\n\t});\n\n\tconst router = injector.get<Router>(routerKey);\n\tif (router) {\n\t\tif (!icache.get('handle')) {\n\t\t\tconst handle = router.on('route', ({ route }) => {\n\t\t\t\tif (route.id === to) {\n\t\t\t\t\tinvalidator();\n\t\t\t\t}\n\t\t\t});\n\t\t\ticache.set('handle', () => handle);\n\t\t}\n\t\tconst context = router.getRoute(to);\n\t\tconst isActive = context && paramsEqual(params, { ...context.params, ...context.queryParams });\n\t\tconst contextIsExact = context && context.isExact();\n\n\t\tclasses = Array.isArray(classes) ? classes : [classes];\n\t\tif (isActive && (!isExact || contextIsExact)) {\n\t\t\tclasses = [...classes, ...activeClasses];\n\t\t}\n\t\tprops = { ...props, classes };\n\t}\n\treturn w(Link, props, children());\n});\n\nexport default ActiveLink;\n"]}
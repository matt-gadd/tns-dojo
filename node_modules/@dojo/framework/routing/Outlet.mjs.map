{"version":3,"file":"Outlet.mjs","sourceRoot":"","sources":["Outlet.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,cAAc,CAAC;AACtE,OAAO,QAAQ,MAAM,6BAA6B,CAAC;AACnD,OAAO,MAAM,MAAM,2BAA2B,CAAC;AAM/C,MAAM,UAAU,GAAG,QAAQ,CAAC;AA4B5B,MAAM,OAAO,GAAG,MAAM,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,WAAW,EAAE,CAAC;KACrE,UAAU,EAAoB;KAC9B,QAAQ,EAAwC,CAAC;AAEnD,MAAM,CAAC,MAAM,MAAM,GAAG,OAAO,CAAC,SAAS,MAAM,CAAC,EAC7C,UAAU,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,WAAW,EAAE,EAC3D,UAAU,EACV,QAAQ,EACR;IACA,YAAY,CAAC,WAAW,EAAE,CAAC,OAAwB,EAAE,IAAqB,EAAE,EAAE;QAC7E,MAAM,EAAE,SAAS,EAAE,gBAAgB,GAAG,UAAU,EAAE,GAAG,OAAO,CAAC;QAC7D,MAAM,EAAE,SAAS,GAAG,UAAU,EAAE,GAAG,IAAI,CAAC;QACxC,IAAI,SAAS,KAAK,gBAAgB,EAAE;YACnC,MAAM,aAAa,GAAG,MAAM,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;YACrD,IAAI,aAAa,EAAE;gBAClB,aAAa,EAAE,CAAC;aAChB;YACD,MAAM,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAC7C,IAAI,MAAM,EAAE;gBACX,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC;aACnC;SACD;QACD,WAAW,EAAE,CAAC;IACf,CAAC,CAAC,CAAC;IACH,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,SAAS,GAAG,UAAU,EAAE,GAAG,UAAU,EAAE,CAAC;IAC7D,MAAM,CAAC,cAAc,CAAC,GAAG,QAAQ,EAAE,CAAC;IAEpC,MAAM,aAAa,GAAG,MAAM,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;IACrD,IAAI,CAAC,aAAa,EAAE;QACnB,MAAM,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC7C,IAAI,MAAM,EAAE;YACX,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC;SACnC;KACD;IAED,MAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAS,SAAS,CAAC,CAAC;IAE/C,IAAI,MAAM,EAAE;QACX,MAAM,mBAAmB,GAAG,MAAM,CAAC,eAAe,EAAE,CAAC;QACrD,MAAM,eAAe,GAAG,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QAC7C,IAAI,eAAe,IAAI,mBAAmB,EAAE;YAC3C,IAAI,OAAO,cAAc,KAAK,UAAU,EAAE;gBACzC,OAAO,cAAc,mBAAM,mBAAmB,IAAE,MAAM,IAAG,CAAC;aAC1D;YACD,IAAI,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,MAAM,CAC/C,CAAC,OAAO,EAAE,GAAG,EAAE,EAAE;gBAChB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBAC1C,OAAO,OAAO,CAAC;YAChB,CAAC,EACD,EAAa,CACb,CAAC;YACF,IAAI,OAAO,EAAE;gBACZ,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;aAC5C;YACD,OAAO,CACN,qBACE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;iBACnB,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;iBAC7B,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;gBACZ,MAAM,QAAQ,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC;gBACrC,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;oBACnC,MAAM,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,mBAAmB,CAAC;oBAChE,OAAO,QAAQ,mBAAM,OAAO,IAAE,MAAM,IAAG,CAAC;iBACxC;gBACD,OAAO,QAAQ,CAAC;YACjB,CAAC,CAAC,CACM,CACV,CAAC;SACF;KACD;IACD,OAAO,IAAI,CAAC;AACb,CAAC,CAAC,CAAC;AAEH,eAAe,MAAM,CAAC","sourcesContent":["import { create, tsx, diffProperty, invalidator } from '../core/vdom';\nimport injector from '../core/middleware/injector';\nimport icache from '../core/middleware/icache';\nimport { RenderResult } from '../core/interfaces';\nimport { MatchDetails, RouteContext } from './interfaces';\nimport Router from './Router';\nimport { RouteProperties } from './Route';\n\nconst ROUTER_KEY = 'router';\n\nexport interface RouteMatch {\n\t[index: string]: boolean;\n}\n\nexport interface Matches {\n\t[index: string]: boolean;\n}\n\nexport interface Matcher {\n\t(defaultMatches: Matches, matchDetails: Map<string, RouteContext>): Matches;\n}\n\nexport interface OutletProperties {\n\tid: string;\n\tmatcher?: Matcher;\n\trouterKey?: string;\n}\n\nexport interface OutletChildren {\n\t[index: string]: RenderResult | ((matchDetails: MatchDetails) => RenderResult);\n}\n\nexport interface OutletFunctionChild {\n\t(matchDetails: MatchDetails): RenderResult;\n}\n\nconst factory = create({ icache, injector, diffProperty, invalidator })\n\t.properties<OutletProperties>()\n\t.children<OutletChildren | OutletFunctionChild>();\n\nexport const Outlet = factory(function Outlet({\n\tmiddleware: { icache, injector, diffProperty, invalidator },\n\tproperties,\n\tchildren\n}) {\n\tdiffProperty('routerKey', (current: RouteProperties, next: RouteProperties) => {\n\t\tconst { routerKey: currentRouterKey = ROUTER_KEY } = current;\n\t\tconst { routerKey = ROUTER_KEY } = next;\n\t\tif (routerKey !== currentRouterKey) {\n\t\t\tconst currentHandle = icache.get<Function>('handle');\n\t\t\tif (currentHandle) {\n\t\t\t\tcurrentHandle();\n\t\t\t}\n\t\t\tconst handle = injector.subscribe(routerKey);\n\t\t\tif (handle) {\n\t\t\t\ticache.set('handle', () => handle);\n\t\t\t}\n\t\t}\n\t\tinvalidator();\n\t});\n\tconst { id, matcher, routerKey = ROUTER_KEY } = properties();\n\tconst [outletChildren] = children();\n\n\tconst currentHandle = icache.get<Function>('handle');\n\tif (!currentHandle) {\n\t\tconst handle = injector.subscribe(routerKey);\n\t\tif (handle) {\n\t\t\ticache.set('handle', () => handle);\n\t\t}\n\t}\n\n\tconst router = injector.get<Router>(routerKey);\n\n\tif (router) {\n\t\tconst currentRouteContext = router.getMatchedRoute();\n\t\tconst routeContextMap = router.getOutlet(id);\n\t\tif (routeContextMap && currentRouteContext) {\n\t\t\tif (typeof outletChildren === 'function') {\n\t\t\t\treturn outletChildren({ ...currentRouteContext, router });\n\t\t\t}\n\t\t\tlet matches = Object.keys(outletChildren).reduce(\n\t\t\t\t(matches, key) => {\n\t\t\t\t\tmatches[key] = !!routeContextMap.get(key);\n\t\t\t\t\treturn matches;\n\t\t\t\t},\n\t\t\t\t{} as Matches\n\t\t\t);\n\t\t\tif (matcher) {\n\t\t\t\tmatches = matcher(matches, routeContextMap);\n\t\t\t}\n\t\t\treturn (\n\t\t\t\t<virtual>\n\t\t\t\t\t{Object.keys(matches)\n\t\t\t\t\t\t.filter((key) => matches[key])\n\t\t\t\t\t\t.map((key) => {\n\t\t\t\t\t\t\tconst renderer = outletChildren[key];\n\t\t\t\t\t\t\tif (typeof renderer === 'function') {\n\t\t\t\t\t\t\t\tconst context = routeContextMap.get(key) || currentRouteContext;\n\t\t\t\t\t\t\t\treturn renderer({ ...context, router });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn renderer;\n\t\t\t\t\t\t})}\n\t\t\t\t</virtual>\n\t\t\t);\n\t\t}\n\t}\n\treturn null;\n});\n\nexport default Outlet;\n"]}